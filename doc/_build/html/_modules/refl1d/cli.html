

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>refl1d.cli &mdash; Refl1D v0.6.19 documentation</title>
    <link rel="stylesheet" href="../../_static/haiku-site.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/print.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6.19',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/MathJax/MathJax.js"></script>
    <script type="text/javascript" src="../../_static/theme_extras.js"></script>
    <link rel="top" title="Refl1D v0.6.19 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="../../_static/logo.png" alt="Logo"/><h1 class="heading"><a href="../../index.html">
          <span>Refl1D v0.6.19 documentation</span></a></h1>
        <h2 class="heading"><span>refl1d.cli</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for refl1d.cli</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dill</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">fitters</span>
<span class="kn">from</span> <span class="nn">.fitters</span> <span class="kn">import</span> <span class="n">FIT_OPTIONS</span><span class="p">,</span> <span class="n">FitDriver</span><span class="p">,</span> <span class="n">StepMonitor</span><span class="p">,</span> <span class="n">ConsoleMonitor</span>
<span class="kn">from</span> <span class="nn">.fitproblem</span> <span class="kn">import</span> <span class="n">FitProblem</span><span class="p">,</span> <span class="n">load_problem</span> <span class="k">as</span> <span class="n">load_script</span>
<span class="kn">from</span> <span class="nn">.mapper</span> <span class="kn">import</span> <span class="n">MPMapper</span><span class="p">,</span> <span class="n">AMQPMapper</span><span class="p">,</span> <span class="n">SerialMapper</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.mystic</span> <span class="kn">import</span> <span class="n">parameter</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">initpop</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__version__</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">pushdir</span>

<div class="viewcode-block" id="mesh"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.mesh">[docs]</a><span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">40</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">]</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="nb">vars</span>
    <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">):</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">model_update</span><span class="p">()</span>
        <span class="c">#parameter.summarize(problem.parameters)</span>
        <span class="k">return</span> <span class="n">problem</span><span class="o">.</span><span class="n">chisq</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fn</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="c"># ===== Model manipulation ====</span>
</div>
<div class="viewcode-block" id="load_problem"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.load_problem">[docs]</a><span class="k">def</span> <span class="nf">load_problem</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span>

    <span class="n">directory</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pushdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.so&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.dll&#39;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.dyld&#39;</span><span class="p">)):</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">garefl</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">problem</span> <span class="o">=</span> <span class="n">garefl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.staj&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.stajconvert</span> <span class="kn">import</span> <span class="n">load_mlayer</span><span class="p">,</span> <span class="n">fit_all</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">problem</span> <span class="o">=</span> <span class="n">FitProblem</span><span class="p">(</span><span class="n">load_mlayer</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="c">#fit_all(problem.fitness, pmp=20)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#print &quot;loading&quot;,filename,&quot;from&quot;,directory</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># First see if it is a pickle</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># Then see if it is a model</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="n">load_script</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
                <span class="c"># Guard against the user changing parameters after defining</span>
                <span class="c"># the problem.</span>
            <span class="n">problem</span><span class="o">.</span><span class="n">model_reset</span><span class="p">()</span>

    <span class="n">problem</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="s">&#39;title&#39;</span><span class="p">):</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
    <span class="k">return</span> <span class="n">problem</span>
</div>
<div class="viewcode-block" id="preview"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.preview">[docs]</a><span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="n">problem</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pylab</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="remember_best"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.remember_best">[docs]</a><span class="k">def</span> <span class="nf">remember_best</span><span class="p">(</span><span class="n">fitdriver</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">best</span><span class="p">):</span>
    <span class="c"># Make sure the problem contains the best value</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
    <span class="c">#print &quot;remembering best&quot;</span>
    <span class="n">pardata</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%.15g</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&quot;.par&quot;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pardata</span><span class="p">)</span>

    <span class="n">fitdriver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">redirect_console</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&quot;.err&quot;</span><span class="p">):</span>
        <span class="n">fitdriver</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">fitdriver</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
    <span class="n">fitdriver</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c">#print &quot;plotting&quot;</span>

</div>
<div class="viewcode-block" id="recall_best"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.recall_best">[docs]</a><span class="k">def</span> <span class="nf">recall_best</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;rt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">par</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mf">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="store_overwrite_query_gui"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.store_overwrite_query_gui">[docs]</a><span class="k">def</span> <span class="nf">store_overwrite_query_gui</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">wx</span>
    <span class="n">msg_dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s">&quot; Already exists. Press &#39;yes&#39; to overwrite, or &#39;No&#39; to abort and restart with newpath&quot;</span><span class="p">,</span><span class="s">&#39;Overwrite Directory&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
    <span class="n">retCode</span> <span class="o">=</span> <span class="n">msg_dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
    <span class="n">msg_dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">retCode</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not create path&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="store_overwrite_query"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.store_overwrite_query">[docs]</a><span class="k">def</span> <span class="nf">store_overwrite_query</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">path</span><span class="p">,</span><span class="s">&quot;already exists.&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Press &#39;y&#39; to overwrite, or &#39;n&#39; to abort and restart with --store=newpath&quot;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Overwrite [y/n]? &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ans</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="s">&quot;yes&quot;</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="make_store"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.make_store">[docs]</a><span class="k">def</span> <span class="nf">make_store</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">exists_handler</span><span class="p">):</span>
    <span class="c"># Determine if command line override</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">store</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">store</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">store</span><span class="p">,</span><span class="n">problem</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c"># Check if already exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&#39;.out&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">store</span><span class="o">+</span><span class="s">&quot; already exists.  Use --overwrite to replace.&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
        <span class="n">exists_handler</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>

    <span class="c"># Create it and copy model</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>

    <span class="c"># Redirect sys.stdout to capture progress</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&quot;.mon&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="run_profile"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.run_profile">[docs]</a><span class="k">def</span> <span class="nf">run_profile</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model execution time profiler.</span>

<span class="sd">    Run the program with &quot;--profile --steps=N&quot; to generate a function</span>
<span class="sd">    profile chart breaking down the cost of evaluating N models.</span>

<span class="sd">    Here is the findings from one profiling session::</span>

<span class="sd">       23 ms total</span>
<span class="sd">        6 ms rendering model</span>
<span class="sd">        8 ms abeles</span>
<span class="sd">        4 ms convolution</span>
<span class="sd">        1 ms setting parameters and computing nllf</span>

<span class="sd">    Using the GPU for abeles/convolution will only give us 2-3x speedup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">profile</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">initpop</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">pars</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="c"># The cost of</span>
    <span class="c"># To get good information from the profiler, you wil</span>
    <span class="c"># Modify this function to obtain different information</span>

    <span class="c"># For gathering stats on just the rendering.</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="s">&#39;fits&#39;</span><span class="p">,[</span><span class="n">problem</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">rendering</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">_render_slabs</span><span class="p">()</span>

    <span class="c">#profile(map,rendering,p)</span>
    <span class="n">profile</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span><span class="n">problem</span><span class="o">.</span><span class="n">nllf</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="c">#map(problem.nllf,p)</span>

</div>
<div class="viewcode-block" id="start_remote_fit"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.start_remote_fit">[docs]</a><span class="k">def</span> <span class="nf">start_remote_fit</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">notify</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Queue remote fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">jobqueue.client</span> <span class="kn">import</span> <span class="n">connect</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s">&#39;refl1d&#39;</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">problem</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">problem</span><span class="p">),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
    <span class="n">request</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">&#39;fitter&#39;</span><span class="p">,</span>
                   <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span> <span class="c"># fitter service version</span>
                   <span class="n">notify</span><span class="o">=</span><span class="n">notify</span><span class="p">,</span>
                   <span class="n">name</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                   <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">job</span>


<span class="c"># ==== option parser ====</span>
</div>
<div class="viewcode-block" id="ParseOpts"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.ParseOpts">[docs]</a><span class="k">class</span> <span class="nc">ParseOpts</span><span class="p">:</span>
    <span class="n">MINARGS</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">FLAGS</span> <span class="o">=</span> <span class="n">set</span><span class="p">()</span>
    <span class="n">VALUES</span> <span class="o">=</span> <span class="n">set</span><span class="p">()</span>
    <span class="n">USAGE</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">flagargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mf">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">flagargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;help&#39;</span> <span class="ow">in</span> <span class="n">flags</span> <span class="ow">or</span> <span class="s">&#39;-h&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="s">&#39;-?&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mf">1</span><span class="p">:]:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">USAGE</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="n">unknown</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLAGS</span>
        <span class="k">if</span> <span class="n">any</span><span class="p">(</span><span class="n">unknown</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown options --</span><span class="si">%s</span><span class="s">.  Use -? for help.&quot;</span><span class="o">%</span><span class="s">&quot;, --&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unknown</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLAGS</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">))</span>

        <span class="n">valueargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">valueargs</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mf">2</span><span class="p">:</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mf">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown option --</span><span class="si">%s</span><span class="s">. Use -? for help.&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">positionargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mf">1</span><span class="p">:]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">positionargs</span>


</div>
<div class="viewcode-block" id="Refl1dOpts"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.Refl1dOpts">[docs]</a><span class="k">class</span> <span class="nc">Refl1dOpts</span><span class="p">(</span><span class="n">ParseOpts</span><span class="p">):</span>
    <span class="n">MINARGS</span> <span class="o">=</span> <span class="mf">1</span>
    <span class="n">FLAGS</span> <span class="o">=</span> <span class="n">set</span><span class="p">((</span><span class="s">&quot;preview&quot;</span><span class="p">,</span> <span class="s">&quot;chisq&quot;</span><span class="p">,</span> <span class="s">&quot;profile&quot;</span><span class="p">,</span> <span class="s">&quot;random&quot;</span><span class="p">,</span> <span class="s">&quot;simulate&quot;</span><span class="p">,</span>
                 <span class="s">&quot;worker&quot;</span><span class="p">,</span> <span class="s">&quot;batch&quot;</span><span class="p">,</span> <span class="s">&quot;overwrite&quot;</span><span class="p">,</span> <span class="s">&quot;parallel&quot;</span><span class="p">,</span> <span class="s">&quot;stepmon&quot;</span><span class="p">,</span>
                 <span class="s">&quot;cov&quot;</span><span class="p">,</span> <span class="s">&quot;remote&quot;</span><span class="p">,</span> <span class="s">&quot;staj&quot;</span><span class="p">,</span> <span class="s">&quot;edit&quot;</span><span class="p">,</span>
                 <span class="s">&quot;multiprocessing-fork&quot;</span><span class="p">,</span> <span class="c"># passed in when app is a frozen image</span>
               <span class="p">))</span>
    <span class="n">VALUES</span> <span class="o">=</span> <span class="n">set</span><span class="p">((</span><span class="s">&quot;plot&quot;</span><span class="p">,</span> <span class="s">&quot;store&quot;</span><span class="p">,</span> <span class="s">&quot;fit&quot;</span><span class="p">,</span> <span class="s">&quot;noise&quot;</span><span class="p">,</span> <span class="s">&quot;seed&quot;</span><span class="p">,</span> <span class="s">&quot;pars&quot;</span><span class="p">,</span>
                  <span class="s">&quot;resynth&quot;</span><span class="p">,</span> <span class="s">&quot;transport&quot;</span><span class="p">,</span> <span class="s">&quot;notify&quot;</span><span class="p">,</span> <span class="s">&quot;queue&quot;</span><span class="p">,</span>
                  <span class="c">#&quot;mesh&quot;,&quot;meshsteps&quot;,</span>
                <span class="p">))</span>
    <span class="c"># Add in parameters from the fitters</span>
    <span class="n">VALUES</span> <span class="o">|=</span> <span class="n">set</span><span class="p">(</span><span class="n">fitters</span><span class="o">.</span><span class="n">FitOptions</span><span class="o">.</span><span class="n">FIELDS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">pars</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">notify</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="n">queue</span><span class="o">=</span><span class="s">&quot;http://reflectometry.org/queue&quot;</span>
    <span class="n">resynth</span><span class="o">=</span><span class="s">&quot;0&quot;</span>
    <span class="n">noise</span><span class="o">=</span><span class="s">&quot;5&quot;</span>
    <span class="n">starts</span><span class="o">=</span><span class="s">&quot;1&quot;</span>
    <span class="n">seed</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="n">PLOTTERS</span><span class="o">=</span><span class="s">&quot;fresnel&quot;</span><span class="p">,</span> <span class="s">&quot;linear&quot;</span><span class="p">,</span> <span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="s">&quot;q4&quot;</span><span class="p">,</span> <span class="s">&quot;residuals&quot;</span><span class="p">,</span> <span class="s">&#39;SA&#39;</span>
    <span class="n">USAGE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Usage: refl1d modelfile [modelargs] [options]</span>

<span class="s">The modelfile is a Python script (i.e., a series of Python commands)</span>
<span class="s">which sets up the data, the models, and the fittable parameters.</span>
<span class="s">The model arguments are available in the modelfile as sys.argv[1:].</span>
<span class="s">Model arguments may not start with &#39;-&#39;.</span>

<span class="s">Options:</span>

<span class="s">    --preview</span>
<span class="s">        display model but do not perform a fitting operation</span>
<span class="s">    --pars=filename</span>
<span class="s">        initial parameter values; fit results are saved as &lt;modelname&gt;.par</span>
<span class="s">    --plot=log      [</span><span class="si">%(plotter)s</span><span class="s">]</span>
<span class="s">        type of reflectivity plot to display</span>
<span class="s">    --random</span>
<span class="s">        use a random initial configuration</span>
<span class="s">    --simulate</span>
<span class="s">        simulate the data to fit</span>
<span class="s">    --noise=5</span><span class="si">%%</span><span class="s"></span>
<span class="s">        percent noise to add to the simulated data</span>
<span class="s">    --cov</span>
<span class="s">        compute the covariance matrix for the model when done</span>
<span class="s">    --staj</span>
<span class="s">        output staj file when done</span>
<span class="s">    --edit</span>
<span class="s">        start the gui</span>

<span class="s">    --store=path</span>
<span class="s">        output directory for plots and models</span>
<span class="s">    --overwrite</span>
<span class="s">        if store already exists, replace it</span>
<span class="s">    --parallel</span>
<span class="s">        run fit using all processors</span>
<span class="s">    --batch</span>
<span class="s">        batch mode; don&#39;t show plots after fit</span>
<span class="s">    --remote</span>
<span class="s">        queue fit to run on remote server</span>
<span class="s">    --notify=user@email OR @twitterid</span>
<span class="s">        remote fit notification (twitter users must follow @reflfit)</span>
<span class="s">    --queue=http://reflectometry.org</span>
<span class="s">        remote job queue</span>

<span class="s">    --fit=amoeba    [</span><span class="si">%(fitter)s</span><span class="s">]</span>
<span class="s">        fitting engine to use; see manual for details</span>
<span class="s">    --steps=1000    [</span><span class="si">%(fitter)s</span><span class="s">]</span>
<span class="s">        number of fit iterations after any burn-in time</span>
<span class="s">    --pop=10        [dream, de, rl, ps]</span>
<span class="s">        population size</span>
<span class="s">    --burn=0        [dream, pt]</span>
<span class="s">        number of burn-in iterations before accumulating stats</span>
<span class="s">    --nT=25</span>
<span class="s">    --Tmin=0.1</span>
<span class="s">    --Tmax=10       [pt]</span>
<span class="s">        temperatures vector; use a higher maximum temperature and a larger</span>
<span class="s">        nT if your fit is getting stuck in local minima</span>
<span class="s">    --CR=0.9        [de, rl, pt]</span>
<span class="s">        crossover ratio for population mixing</span>
<span class="s">    --starts=1      [</span><span class="si">%(fitter)s</span><span class="s">]</span>
<span class="s">        number of times to run the fit from random starting points</span>
<span class="s">    --init=lhs      [dream]</span>
<span class="s">        population initialization method:</span>
<span class="s">          lhs:    latin hypercube sampling</span>
<span class="s">          cov:    normally distributed according to covariance matrix</span>
<span class="s">          random: uniformly distributed within parameter ranges</span>
<span class="s">    --stepmon</span>
<span class="s">        show details for each step</span>
<span class="s">    --resynth=0</span>
<span class="s">        run resynthesis error analysis for n generations</span>

<span class="s">    --chisq</span>
<span class="s">        print the model description and chisq value and exit</span>
<span class="s">    -?/-h/--help</span>
<span class="s">        display this help</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">%</span><span class="p">{</span><span class="s">&#39;fitter&#39;</span><span class="p">:</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">FIT_OPTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span>
     <span class="s">&#39;plotter&#39;</span><span class="p">:</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PLOTTERS</span><span class="p">),</span>
     <span class="p">}</span>

<span class="c">#    --transport=mp  {amqp|mp|mpi}</span>
<span class="c">#        use amqp/multiprocessing/mpi for parallel evaluation</span>
<span class="c">#    --mesh=var OR var+var</span>
<span class="c">#        plot chisq line or plane</span>
<span class="c">#    --meshsteps=n</span>
<span class="c">#        number of steps in the mesh</span>
<span class="c">#For mesh plots, var can be a fitting parameter with optional</span>
<span class="c">#range specifier, such as:</span>
<span class="c">#</span>
<span class="c">#   P[0].range(3,6)</span>
<span class="c">#</span>
<span class="c">#or the complete path to a model parameter:</span>
<span class="c">#</span>
<span class="c">#   M[0].sample[1].material.rho.pm(1)</span>

    <span class="n">_plot</span> <span class="o">=</span> <span class="s">&#39;log&#39;</span>
    <span class="k">def</span> <span class="nf">_set_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PLOTTERS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unknown plot type </span><span class="si">%s</span><span class="s">; use </span><span class="si">%s</span><span class="s">&quot;</span>
                             <span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PLOTTERS</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_plot</span><span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_fitter</span> <span class="o">=</span> <span class="n">fitters</span><span class="o">.</span><span class="n">FIT_DEFAULT</span>
    <span class="k">def</span> <span class="nf">_set_fitter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">set</span><span class="p">(</span><span class="n">FIT_OPTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unknown fitter </span><span class="si">%s</span><span class="s">; use </span><span class="si">%s</span><span class="s">&quot;</span>
                             <span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">FIT_OPTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fitter</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitter</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_fitter</span><span class="p">)</span>
    <span class="n">TRANSPORTS</span> <span class="o">=</span> <span class="s">&#39;amqp&#39;</span><span class="p">,</span><span class="s">&#39;mp&#39;</span><span class="p">,</span><span class="s">&#39;mpi&#39;</span>
    <span class="n">_transport</span> <span class="o">=</span> <span class="s">&#39;mp&#39;</span>
    <span class="k">def</span> <span class="nf">_set_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSPORTS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unknown transport </span><span class="si">%s</span><span class="s">; use </span><span class="si">%s</span><span class="s">&quot;</span>
                             <span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TRANSPORTS</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_transport</span><span class="p">)</span>
    <span class="n">meshsteps</span> <span class="o">=</span> <span class="mf">40</span>
</div>
<div class="viewcode-block" id="getopts"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.getopts">[docs]</a><span class="k">def</span> <span class="nf">getopts</span><span class="p">():</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">Refl1dOpts</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">resynth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">resynth</span><span class="p">)</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">seed</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">fitters</span><span class="o">.</span><span class="n">FIT_DEFAULT</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">fit</span>
    <span class="n">FIT_OPTIONS</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">fit</span><span class="p">]</span><span class="o">.</span><span class="n">set_from_cli</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opts</span>

<span class="c"># ==== Main ====</span>
</div>
<div class="viewcode-block" id="initial_model"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.initial_model">[docs]</a><span class="k">def</span> <span class="nf">initial_model</span><span class="p">(</span><span class="n">opts</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
        <span class="n">problem</span> <span class="o">=</span> <span class="n">load_problem</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">pars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">recall_best</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">random</span><span class="p">:</span>
            <span class="n">problem</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">simulate</span><span class="p">:</span>
            <span class="n">problem</span><span class="o">.</span><span class="n">simulate_data</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">noise</span><span class="p">))</span>
            <span class="c"># If fitting, then generate a random starting point different</span>
            <span class="c"># from the simulation</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">chisq</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">preview</span><span class="p">):</span>
                <span class="n">problem</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">problem</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">problem</span>
</div>
<div class="viewcode-block" id="resynth"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.resynth">[docs]</a><span class="k">def</span> <span class="nf">resynth</span><span class="p">(</span><span class="n">fitdriver</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
    <span class="n">make_store</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">opts</span><span class="p">,</span><span class="n">exists_handler</span><span class="o">=</span><span class="n">store_overwrite_query</span><span class="p">)</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&quot;.rsy&quot;</span><span class="p">,</span><span class="s">&#39;at&#39;</span><span class="p">)</span>
    <span class="n">fitdriver</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">start_mapper</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">resynth</span><span class="p">):</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">resynth_data</span><span class="p">()</span>
        <span class="n">best</span><span class="p">,</span> <span class="n">fbest</span> <span class="o">=</span> <span class="n">fitdriver</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;step </span><span class="si">%d</span><span class="s"> chisq </span><span class="si">%g</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mf">2</span><span class="o">*</span><span class="n">fbest</span><span class="o">/</span><span class="n">problem</span><span class="o">.</span><span class="n">dof</span><span class="p">)</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.15g</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="n">fbest</span><span class="o">/</span><span class="n">problem</span><span class="o">.</span><span class="n">dof</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.15g</span><span class="s">&#39;</span><span class="o">%</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">restore_data</span><span class="p">()</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="config_matplotlib"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.config_matplotlib">[docs]</a><span class="k">def</span> <span class="nf">config_matplotlib</span><span class="p">(</span><span class="n">backend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup matplotlib.</span>

<span class="sd">    The backend should be WXAgg for interactive use, or &#39;Agg&#39; for batch.</span>

<span class="sd">    This must be called before any imports to pylab.  We&#39;ve done this by</span>
<span class="sd">    making sure that pylab is never (rarely?) imported at the top level</span>
<span class="sd">    of a module, and only in the functions that call it: if you are</span>
<span class="sd">    concerned about speed, then you shouldn&#39;t be using pylab :-)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># If we are running from an image built by py2exe, keep the frozen</span>
    <span class="c"># environment self contained by having matplotlib use a private directory</span>
    <span class="c"># instead of using .matplotlib under the user&#39;s home directory for storing</span>
    <span class="c"># shared data files such as fontList.cache.  Note that a Windows</span>
    <span class="c"># installer/uninstaller such as Inno Setup should explicitly delete this</span>
    <span class="c"># private directory on uninstall.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;frozen&#39;</span><span class="p">):</span>
        <span class="n">mplconfigdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#39;.matplotlib&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mplconfigdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mplconfigdir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MPLCONFIGDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mplconfigdir</span>

    <span class="kn">import</span> <span class="nn">matplotlib</span>

    <span class="c"># Specify the backend to use for plotting and import backend dependent</span>
    <span class="c"># classes. Note that this must be done before importing pyplot to have an</span>
    <span class="c"># effect.</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

    <span class="c"># Disable interactive mode so that plots are only updated on show() or</span>
    <span class="c"># draw(). Note that the interactive function must be called before</span>
    <span class="c"># selecting a backend or importing pyplot, otherwise it will have no</span>
    <span class="c"># effect.</span>

    <span class="n">matplotlib</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="beep"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.beep">[docs]</a><span class="k">def</span> <span class="nf">beep</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Audio signal that fit is complete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">winsound</span>
        <span class="n">winsound</span><span class="o">.</span><span class="n">MessageBeep</span><span class="p">(</span><span class="n">winsound</span><span class="o">.</span><span class="n">MB_ICONEXCLAMATION</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\a</span><span class="s">&quot;</span>
</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../api/cli.html#refl1d.cli.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;-?&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">No modelfile parameter was specified.</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">getopts</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">edit</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.gui.gui_app</span> <span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">gui</span>
        <span class="n">gui</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="c"># Set up the matplotlib backend to minimize the wx dependency.</span>
    <span class="n">config_matplotlib</span><span class="p">(</span><span class="s">&#39;Agg&#39;</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">remote</span> <span class="k">else</span> <span class="s">&#39;WXAgg&#39;</span><span class="p">)</span>

    <span class="n">problem</span> <span class="o">=</span> <span class="n">initial_model</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

    <span class="c"># TODO: AMQP mapper as implemented requires workers started up with</span>
    <span class="c"># the particular problem; need to be able to transport the problem</span>
    <span class="c"># to the worker instead.  Until that happens, the GUI shouldn&#39;t use</span>
    <span class="c"># the AMQP mapper.</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">parallel</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">transport</span> <span class="o">==</span> <span class="s">&#39;amqp&#39;</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">AMQPMapper</span>
        <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">transport</span> <span class="o">==</span> <span class="s">&#39;mp&#39;</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">MPMapper</span>
        <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">transport</span> <span class="o">==</span> <span class="s">&#39;mpi&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;mpi transport not implemented&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mapper</span> <span class="o">=</span> <span class="n">SerialMapper</span>

    <span class="n">fitopts</span> <span class="o">=</span> <span class="n">FIT_OPTIONS</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">fit</span><span class="p">]</span>
    <span class="n">fitdriver</span> <span class="o">=</span> <span class="n">FitDriver</span><span class="p">(</span><span class="n">fitopts</span><span class="o">.</span><span class="n">fitclass</span><span class="p">,</span> <span class="n">problem</span><span class="o">=</span><span class="n">problem</span><span class="p">,</span> <span class="o">**</span><span class="n">fitopts</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>

    <span class="c"># Which format to view the plots</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># TODO: separate refl specific parameters from generic fitter parameters</span>
        <span class="kn">from</span> <span class="nn">.probe</span> <span class="kn">import</span> <span class="n">Probe</span>
        <span class="n">Probe</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">plot</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">profile</span><span class="p">:</span>
        <span class="n">run_profile</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
        <span class="n">mapper</span><span class="o">.</span><span class="n">start_worker</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">chisq</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">cov</span><span class="p">:</span> <span class="k">print</span> <span class="n">problem</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;chisq&quot;</span><span class="p">,</span><span class="n">problem</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">preview</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">cov</span><span class="p">:</span> <span class="k">print</span> <span class="n">problem</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
        <span class="n">preview</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">resynth</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span>
        <span class="n">resynth</span><span class="p">(</span><span class="n">fitdriver</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">remote</span><span class="p">:</span>

        <span class="c"># Check that problem runs before submitting it remotely</span>
        <span class="n">chisq</span> <span class="o">=</span> <span class="n">problem</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;initial chisq:&quot;</span><span class="p">,</span> <span class="n">chisq</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">start_remote_fit</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span>
                               <span class="n">queue</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">notify</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;remote job:&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">make_store</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">opts</span><span class="p">,</span><span class="n">exists_handler</span><span class="o">=</span><span class="n">store_overwrite_query</span><span class="p">)</span>

        <span class="c"># Show command line arguments and initial model</span>
        <span class="k">print</span> <span class="s">&quot;#&quot;</span><span class="p">,</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">stepmon</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">output_path</span><span class="o">+</span><span class="s">&#39;.log&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fitdriver</span><span class="o">.</span><span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">ConsoleMonitor</span><span class="p">(</span><span class="n">problem</span><span class="p">),</span>
                               <span class="n">StepMonitor</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">fid</span><span class="p">,</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;step&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">])]</span>

        <span class="n">fitdriver</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">start_mapper</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">best</span><span class="p">,</span> <span class="n">fbest</span> <span class="o">=</span> <span class="n">fitdriver</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">remember_best</span><span class="p">(</span><span class="n">fitdriver</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">best</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">cov</span><span class="p">:</span> <span class="k">print</span> <span class="n">cov</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
        <span class="n">beep</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pylab</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c"># Allow  &quot;$python -m refl1d.cli args&quot; calling pattern</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">main</span><span class="p">()</span>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2006-2011, Paul Kienzle, Nikunj Patel, James Krycka.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>